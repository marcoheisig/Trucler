\chapter{Augmenting the environment}

\section{Adding and annotating variables}

\subsection{Adding a lexical variable}

{\footnotesize
\Defgeneric {add-lexical-variable} {client environment name \optional identity}
}

This function returns a new environment that is like
\textit{environment} except that it has been augumented with a lexical
variable named \textit{name}.  The optional argument \textit{identity}
can be supplied by client code to distinguish different lexical
variables with the same name.

\subsection{Adding a special variable}

{\footnotesize
\Defgeneric {add-special-variable} {client environment name}
}

This function returns a new environment that is like
\textit{environment} except that it has been augumented with a special
variable named \textit{name}.

\subsection{Annotating a variable with a type}
\label{sec-annotating-a-variable-with-a-type}

{\footnotesize
\Defgeneric {add-variable-type} {client environment name type}
}

This function returns a new environment that is like
\textit{environment} except that the variable named \textit{name} has
been annotated with the type specifier \textit{type}.

The type of the variable returned when the new environment is queried
for the variable named \textit{name} will have a new type that is the
conjunction of \textit{type} and the type it had in
\textit{environment}.

This function can be used when \textit{name} names a lexical variable,
a special variable, or a symbol macro
\seesec{sec-annotating-a-symbol-macro-with-a-type}, but \emph{not}
  when \textit{name} names a constant variable.

\section{Adding and annotating symbol macros}

\subsection{Adding a local symbol macro}

{\footnotesize
\Defgeneric {add-local-symbol-macro} {client environment name expansion}
}

This function returns a new environment that is like
\textit{environment} except that it has been augmented with a local
symbol macro named \texttt{name}, with the expansion
\textit{expansion}

\subsection{Annotating a symbol macro with a type}
\label{sec-annotating-a-symbol-macro-with-a-type}

The generic function \texttt{add-variable-type}
\seesec{sec-annotating-a-variable-with-a-type} can be used to annotate
the type of a (local or global) symbol macro.

\section{Adding and annotating functions}

\subsection{Adding a local function}

{\footnotesize
\Defgeneric {add-local-function} {client environment name \optional identity}
}

This function returns a new environment that is like
\textit{environment} except that it has been augumented with a local
function named \textit{name}.  The optional argument \textit{identity}
can be supplied by client code to distinguish different functions with
the same name.

\section{Adding and annotating macros}

{\footnotesize
\Defgeneric {add-local-macro} {client environment name expander}
}

This function returns a new environment that is like
\textit{environment} except that it has been augmented with a local
macro named \texttt{name}.  The argument \textit{expander} is a
macro-expansion function that takes two arguments, a form and an
environment.

\section{Adding a block}

{\footnotesize
\Defgeneric {add-block} {client environment name \optional identity}
}

This function returns a new environment that is like
\textit{environment} except that it has been augumented with a block
named \textit{name}, which must be a symbol.  The optional argument
\textit{identity} can be supplied by client code to distinguish
different blocks with the same name.

\section{Adding a tag}

{\footnotesize
\Defgeneric {add-tag} {client environment tag \optional identity}
}

This function returns a new environment that is like
\textit{environment} except that it has been augumented with a tag
named \textit{tag}, which must be a \emph{go tag}, i.e. a symbol or an
integer.  The optional argument \textit{identity} can be supplied by
client code to distinguish different tags with the same name.
